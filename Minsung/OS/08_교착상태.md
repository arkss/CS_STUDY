# 08. 교착상태

## 01. 교착상태란?

**교착상태(deadlock)**는 다음과 같이 정의할 수 있습니다.

한 프로세스들의 집합 내에서 각각의 프로세스가 그 집합 내의 다른 프로세스만이 발생시킬 수 있는 이벤트를 기다리고 있으면 그 집합의 프로세스들은 교착상태에 걸려있다고 할 수 있습니다.

대부분의 경우에는 각 프로세스가 기다리고 있는 이벤트는 다른 프로세스가 점유하고 있어 사용하지 못하는 자원이 반환되는 것입니다. 

여기서 자원이란 하드웨어와 소프트웨어를 총 망라하는 자원들을 의미합니다.

또한 이렇게 자원에 의해 일어나는 교착상태를 **자원 교착상태** 라고 합니다.



### 자원 교착상태의 조건

교착상태가 되기 위해서는 아래 4가지 조건이 만족해야 합니다.

1. mutual exclusion

   상호배제라고 하며 각 자원은 현재 정확하게 하나의 프로세스에게 할당되어 있거나 혹은 가용한 상태

2. hold and wait

   현재 자원을 보유하고 있는 프로세스가 새로운 자원을 요청

3. no preemption

   비선점이라고 하며 다른 프로세스의 자원을 강제로 빼았을 수 없음

4. circular wait

   둘 이상의 프로세스들의 순환 체인이 있어야 함

   



### 교착상태를 해결하기 위한 전략

1. 무시
2. 탐지 및 회복
3. 자원 할당을 조심하여 동적 회피
4. `자원 교착상태의 조건` 을 막아 예방





## 02. 교착상태를 해결하기 위한 전략(1) - 무시

교착상태를 해결하기 위한 첫 번째 전략은 **무시**하는 방법입니다.

이는 **타조 알고리즘**이라고도 하는데 타조가 머리를 모레에 처박고 아무런 문제가 없는 척 하는 것에서 따왔습니다.



## 03. 교착상태를 해결하기 위한 전략(2) - 탐지 및 회복

두 번째 전략은 **탐지와 회복**입니다.

이는 교착상태의 발생을 예방하려고 하지 않습니다.

다만 교착상태가 발생한 것을 검출하고 이를 회복하기 위해 노력합니다.



### 타입마다 자원이 하나인 경우 교착상태 탐지

각 타입마다 자원이 단 하나만 존재하는 경우, 자원과 프로세스에 대해 그래프를 만들 수 있습니다.

해당 그래프에서 사이클이 있다면 교착상태이고, 사이클이 없으면 교착상태가 아닙니다.



### 타입마다 자원이 다수인 경우 교착상태 탐지

https://m.blog.naver.com/PostView.nhn?blogId=doublebee1&logNo=220356473254&proxyReferer=https:%2F%2Fwww.google.com%2F



<br>

위와 같은 방법으로 교착상태를 탐지했다면 교착상태로 부터 회복해야합니다.

아래 3가지의 회복 방법이 있지만 매력적인 방법은 없습니다.

### 선점을 통한 회복

자원을 프로세스로 부터 회수하여 다른 프로세스에게 주는 방법입니다.

하지만 자원에 따라서 이러한 방식의 회복이 매우 어렵거나 불가능하기도 합니다.

이 때 어떤 프로세스로 부터 어떤 자원을 회수할 지에 대한 판단은 어떤  프로세스가 쉽게 돌려받을 수 있는 자원을 가지고 있느냐에 따라 다릅니다.



### 롤백을 통한 회복

교착상태로 부터 회복하기 위해 프로세스를 과거로 되돌리는 방법입니다.

과거로 되돌린다는 의미는 교착상태에 빠지게끔 하는 자원을 획득하기 전으로 롤백한다는 것을 의미합니다.

이를 위해 정기적으로 프로세스들을 체크포인팅하여 이것의 상태를 파일에 기록합니다.



### 프로세스 강제 종료를 통한 회복

가장 간단한 방법은 교착상태에 빠지게끔 하는 프로세스를 강제 종료하는 것입니다.

하나의 프로세스를 종료하여도 끝나지 않는다면 교착상태가 끝날 때까지 프로세스를 죽이게 됩니다.





## 레퍼런스

* 운영체제론

## 질문할 사항



## 추가 공부할 키워드

