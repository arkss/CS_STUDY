# CSRF, XSS, SQL Injection 등 웹 취약점 공격



## XSS

> Cross Site Scripting

웹 어플리케이션에서 많이 나타나는 취약점 중 하나입니다.

웹 사이트 관리자가 아닌 공격자가 웹페이지에 악성 스크립트를 삽입할 수 있는 약점입니다.

사용자가 입력한 값을 제대로 검사하지 않아 악성 스크립트가 실행되는 형태가 주를 이룹니다.

이를 통해 공격자는 사용자의 정보(쿠키)를 탈취할 수 있습니다.



### 종류

- Stored XSS

  - 일반적인 XSS 공격 유형
  - 사용자가 사이트 이용중, 공격자가 입력해둔 악성 스크립트가 실행됩니다.

  

- Reflected XSS

  - 일반적인 피싱 공격
  - URL 파라미터에 스크립트를 넣어 서버에 저장하지 않고 즉시 스크립트를 만드는 방식입니다.
  - 사용자가 게시물 조회를 요청 할 때 
    서버가 해당 요청에 대하여 조회 한 결과를 응답에 출력하며, 사용자가 조회한 내용을 응답에 포함시킵니다.



### 대응 방안

- 쿠키에 중요한 정보를 담지 않거나, 갱신
- javascript - httponly 속성을 통해 `document.cookie` 를 통해 쿠키에 접근을 막을 수 있습니다.





## CSRF

> Cross Site Request Forgery
> 공격자가 의도한 행위를 이를 의도하지 않은 사용자가 하도록 만드는 공격입니다.

csrf 공격을 통해 공격자가 얻을 수 있는 이득은 **세션 쿠키를 가진 사람만 사용할 수 있는 기능을 요청할 수 있다**는 것입니다.



### 공격 방식

1. 사용자의 세션 정보에 해당하는 쿠키 값이 브라우저에 저장된 상태
2. 사용자의 인증 정보를 활용한 악의적 스크립트 실행
3. 서버는 사용자의 요청으로 착각, 구분하지 못하고 실행



### 방어

- **CSRF Token** 을 사용합니다.
  - 서버 백엔드에서 **요청을 받을 때마다 세션에 저장된 토큰 값과 요청 파라미터에 전달되는 토큰 값이 일치**하는지 검증하게 됩니다.
  - CSRF Token은 임의의 난수를 생성하고 세션에 저장합니다.
  - 그리고 사용자의 매 요청마다 해당 난수 값을 포함시켜서 전송합니다.
  - 이후 백엔드에서 요청마다 **세션에 저장된 토큰값과 요청 파라미터에 전달된 토큰 값이 같은지 검사**한다.





## SQL Injection

SQL injection 이란, 보안상의 취약점을 이용하여
임의의 SQL 문을 주입하여 DB 의 비정상적 동작을 하도록 조작하는 행위를 말합니다.



### 공격 방식

- Error based SQL Injection
- Blind SQL Injcetion
- Union SQL Injection



#### Error based SQL Injection

말 그대로, 에러를 이용한 공격 기법으로 고의로 SQL 문에 에러를 발생시킵니다.

에러 메세지를 통해 쿼리문의 구성을 추측하고, DB의 구조 파악까지 가능합니다.

**따라서, 에러가 발생하더라도 front에 에러 메세지를 띄우지 않는 것을 추천합니다.**



#### Blind SQL Injection

위에서 언급한, 에러 메세지가 보이지 않는 경우 사용하는 기법입니다.

이는 특정 쿼리문으로 인한 결과가 참/거짓인 것 만 알 수 있을 때 사용합니다.



#### Union SQL Injection

Union 쿼리를 사용하는 기법입니다.

공격에 쓰이는 union 연산을 위해 두 테이블의 컬럼 수와 데이터 형이 같아야하는 조건이 있지만, 이를 만족하면 다른 정보들도 함께 조회할 수 있습니다.



### 방어

공격 방법에 대한 기법과 키워드는 굉장히 많습니다. 다만, 이는 사용자 입력값을 그대로 믿고 사용하기 때문에 발생합니다.

**따라서, 사용자의 입력값을 반드시 검증한 뒤 사용해야 합니다.**

```ruby
# Ruby on Rails SQL Injection
# 나쁜 예 - 어떠한 매개변수든지 들어갈 수 있음
Client.where("orders_count = #{params[:orders]}")

# 좋은 예 - 적절한 매개변수만 들어갈 수 있음
Client.where('orders_count = ?', params[:orders])
```

위와 같이 사용자의 입력을 그대로 사용하지 않고, 단순한 문자열로 인식할 수 있어야 합니다.

또한, 에러 메세지를 노출하지 않아야 합니다.





## 레퍼런스

- [https://un1c0n.tistory.com/entry/웹-취약점공격기법-정리](https://un1c0n.tistory.com/entry/%EC%9B%B9-%EC%B7%A8%EC%95%BD%EC%A0%90%EA%B3%B5%EA%B2%A9%EA%B8%B0%EB%B2%95-%EC%A0%95%EB%A6%AC)
- https://program-developer.tistory.com/99
- https://noirstar.tistory.com/264
- https://kk-7790.tistory.com/74



## 추가 공부할 사항





## 질문할 키워드

