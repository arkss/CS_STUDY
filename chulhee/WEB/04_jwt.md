# JWT 

> Json Web Token

인증을 위해 사용하는 암호화된 토큰을 의미합니다.

**Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token** 입니다.
JWT는 토큰 자체를 정보로 사용하는 Self-Contained 방식으로 정보를 안전하게 전달합니다.

주로 로컬 스토리지에 저장해두고 사용하게 됩니다.





## JWT 토큰 구성

> aaaaaa(헤더).bbbbbb(페이로드).cccccc(서명)

3가지 파트로 구분되며 각 파트는 점으로 구분합니다.

Base64 인코딩의 경우 +, /, = 이 포함되지만 
JWT는 URI에서 파라미터로 사용할 수 있도록 URL-Safe 한 **Base64url 인코딩**을 사용합니다.
모든 부분은 JSON 형태로 인코딩되어 표현됩니다.

- **헤더**
  - 토큰의 타입과 해시 암호화 알고리즘으로 구성
    - 해시 알고리즘(HMAC, SHA256, RSA)
  - typ 는 토큰의 타입을 지정
  - alg 는 알고리즘 방식을 지정하며, 서명 및 토큰 검증에 사용합니다.

```json
{ 
 "alg": "HS256",
 "typ": JWT
 }
```



- **페이로드**
  
  - 토큰에 담을 정보의 조각들을 포함하고 있습니다.
  - 여기에 담기는 정보의 한 조각을 **클레임** 이라고 부릅니다.
    - Name : Value 한 쌍으로 구성
    - 클레임의 정보
      - 등록된 (registered) 클레임
      - 공개 (public) 클레임
      - 비공개 (private) 클레임
  
  
  
  - **등록된 클레임**
    - 토큰 정보를 표현하기 위해 이미 정해진 종류의 데이터
  - **공개 클레임**
    - 사용자 정의 클레임으로, **공개용 정보를 위해 사용**
  - **비공개 클레임**
    - 사용자 정의 클레임으로, **서버와 클라이언트 사이에 임의로 지정한 정보를 저장**



- **서명**
  - 토큰을 인코딩하거나, 유효성 검증을 할 때 사용하는 고유 암호화 코드입니다.
  - 헤더와 페이로드 값을 BASE64로 인코딩하고, 
    인코딩한 값을 **비밀키**를 이용하여 헤더에서 정의한 알고리즘으로 해싱을합니다. 
    이 값을 다시 BASE64로 인코딩하여 생성합니다.



최종 생성된 토큰은 HTTP 통신할 때 사용하게 됩니다.

```json
{
  "Authorization": "Bearer {token}"
}
```



### 비밀키는 어디서 나왔나?

JWT 에서 사용하는 암호방식은 공개키 암호방식을 사용합니다.

공개키 암호 방식이란, 
비대칭 암호 방식을 이용하여 공개키와 비밀키를 생성하여 이를 통신 시에 사용합니다.

- **공개 키 암호 방식은 비밀 키로 암호화한 데이터를 공개 키로 복호화 할 수 있고, 반대로 공개키로 암호화 한 데이터는 비밀 키로 복호화할 수 있다**

- **비밀 키로 암호화한 것을 비밀 키로 풀거나 공개 키로 암호화한 것을 공개 키로 풀 수 없습니다.**





## JWT 사용 과정

로그인 과정을 예시로 사용하겠습니다.

1. **유저는 회원 정보를 입력합니다.**
2. **서버에서 JWT 를 만들고 이를 보내줍니다.**
   - 여기까지, JWT 생성 과정입니다.
3. **브라우저는 JWT를 가지고, 서버에게 데이터를 요청합니다.**
4. **서버는 토큰의 서명을 확인하고, 유저 정보를 클라이언트에게 제공합니다.**
   - 3, 4번은 JWT를 통해 인증을 확인하는 과정입니다.



### 사용 목적

- 회원인증
  - 유저의 정보를 세션에 유지할 필요가 없게 됩니다. 
    - 즉, stateless 한 서버를 만들 수 있게 도와줍니다. 











## 레퍼런스

- https://mangkyu.tistory.com/56
- 



## 질문할 사항



 ## 추가 공부할 키우드

- stateful vs stateless
- 